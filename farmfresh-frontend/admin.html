<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard - FarmFresh</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="script.js" defer></script>
</head>
<body style="
  margin:0;
  padding:0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: url('https://images.pexels.com/photos/219794/pexels-photo-219794.jpeg') center/cover no-repeat fixed;
  min-height: 100vh;
  color: #333;
">

  <!-- Overlay for readability -->
  <div style="
    position: fixed;
    top:0;
    left:0;
    width:100%;
    height:100%;
    background: rgba(248,255,254,0.9);
    z-index:-1;
  "></div>

  <!-- Header -->
  <header style="
    display:flex;
    justify-content: space-between;
    align-items: center;
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: white;
    padding: 2rem;
    box-shadow: 0 4px 15px rgba(34,197,94,0.3);
  ">
    <h1 style="margin:0; font-family:'Poppins',sans-serif;">Admin Dashboard</h1>
    <button onclick="logout()" style="
      background: white;
      color: #16a34a;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(34,197,94,0.3);
    " onmouseover="
      this.style.background='#16a34a';
      this.style.color='white';
      this.style.transform='translateY(-2px)';
      this.style.boxShadow='0 6px 20px rgba(34,197,94,0.5)';
    " onmouseout="
      this.style.background='white';
      this.style.color='#16a34a';
      this.style.transform='translateY(0)';
      this.style.boxShadow='0 4px 12px rgba(34,197,94,0.3)';
    ">Logout</button>
  </header>

  <main style="max-width:1200px; margin:2rem auto; padding:0 1rem;">

    <!-- Products Section -->
    <section style="margin-bottom:3rem;">
      <h2 style="color:#16a34a; font-family:'Poppins',sans-serif;">All Products</h2>
      <div id="productsContainer" style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top:1rem;
      "></div>

      <hr style="margin:2rem 0; border:none; border-top:2px solid #22c55e;">

      <h3 style="color:#16a34a; font-family:'Poppins',sans-serif;">Add New Product</h3>
      <form id="addProductForm" style="
        display:flex;
        flex-direction: column;
        gap:1rem;
        max-width:400px;
      ">
        <input type="text" id="prodName" placeholder="Name" required style="padding:0.8rem; border-radius:8px; border:1px solid #ccc;">
        <input type="number" id="prodPrice" placeholder="Price" required style="padding:0.8rem; border-radius:8px; border:1px solid #ccc;">
        <input type="text" id="prodDesc" placeholder="Description" style="padding:0.8rem; border-radius:8px; border:1px solid #ccc;">
        <button type="submit" style="
          background:#22c55e;
          color:white;
          border:none;
          padding:1rem 0;
          border-radius:8px;
          font-weight:600;
          cursor:pointer;
          transition: all 0.3s ease;
          box-shadow:0 4px 15px rgba(34,197,94,0.4);
        " onmouseover="
          this.style.background='#16a34a';
          this.style.transform='translateY(-2px)';
          this.style.boxShadow='0 6px 20px rgba(34,197,94,0.6)';
        " onmouseout="
          this.style.background='#22c55e';
          this.style.transform='translateY(0)';
          this.style.boxShadow='0 4px 15px rgba(34,197,94,0.4)';
        ">Add Product</button>
      </form>
    </section>

    <!-- Orders Section -->
    <section>
      <h2 style="color:#16a34a; font-family:'Poppins',sans-serif;">All Orders</h2>
      <div id="ordersContainer" style="
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top:1rem;
      "></div>
    </section>

  </main>

  <script>
    async function loadProducts() {
      const token = getToken();
      if (!token) {
        window.location.href = "login.html";
        return;
      }

      const res = await fetch(`${API_URL}/products`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      const container = document.getElementById("productsContainer");
      container.innerHTML = "";

      data.forEach(prod => {
        const div = document.createElement("div");
        div.style.cssText = `
          background:white;
          border-radius:16px;
          padding:1rem;
          box-shadow:0 4px 15px rgba(0,0,0,0.08);
          display:flex;
          flex-direction:column;
          gap:0.5rem;
          transition:all 0.3s ease;
        `;
        div.onmouseenter = () => {
          div.style.transform='translateY(-5px)';
          div.style.boxShadow='0 12px 30px rgba(0,0,0,0.15)';
        };
        div.onmouseleave = () => {
          div.style.transform='translateY(0)';
          div.style.boxShadow='0 4px 15px rgba(0,0,0,0.08)';
        };
        div.innerHTML = `
          <h4 style="margin:0; color:#374151;">${prod.name}</h4>
          <p style="margin:0; color:#6b7280;">Price: $${prod.price}</p>
          <p style="margin:0; color:#6b7280;">${prod.description}</p>
        `;
        container.appendChild(div);
      });
    }

    async function loadOrders() {
      const token = getToken();
      const res = await fetch(`${API_URL}/orders/all`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      const container = document.getElementById("ordersContainer");
      container.innerHTML = "";

      if (data.length === 0) {
        container.innerHTML = "<p style='text-align:center;'>No orders found.</p>";
        return;
      }

      data.forEach(order => {
        const div = document.createElement("div");
        div.style.cssText = `
          background:white;
          border-radius:16px;
          padding:1rem;
          box-shadow:0 4px 15px rgba(0,0,0,0.08);
          display:flex;
          flex-direction:column;
          gap:0.5rem;
          transition:all 0.3s ease;
        `;
        div.onmouseenter = () => {
          div.style.transform='translateY(-5px)';
          div.style.boxShadow='0 12px 30px rgba(0,0,0,0.15)';
        };
        div.onmouseleave = () => {
          div.style.transform='translateY(0)';
          div.style.boxShadow='0 4px 15px rgba(0,0,0,0.08)';
        };
        div.innerHTML = `
          <h4 style="margin:0; color:#374151;">Order ID: ${order._id}</h4>
          <p style="margin:0; color:#6b7280;">User: ${order.user.name} (${order.user.email})</p>
          <p style="margin:0; color:#6b7280;">Status: ${order.status}</p>
          <ul style="margin:0; padding-left:1.2rem; color:#374151;">
            ${order.items.map(i => `<li>${i.product.name} x ${i.qty}</li>`).join('')}
          </ul>
        `;
        container.appendChild(div);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      loadProducts();
      loadOrders();

      document.getElementById("addProductForm").addEventListener("submit", async e => {
        e.preventDefault();
        const token = getToken();
        const name = document.getElementById("prodName").value;
        const price = document.getElementById("prodPrice").value;
        const description = document.getElementById("prodDesc").value;

        const res = await fetch(`${API_URL}/products`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ name, price, description })
        });

        const data = await res.json();
        if (res.ok) {
          alert("Product added!");
          loadProducts();
        } else {
          alert(data.message);
        }
      });
    });
  </script>
</body>
</html>
