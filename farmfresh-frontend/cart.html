<!DOCTYPE html>
<html>

<head>
  <title>Cart - FarmFresh</title>
  <link rel="stylesheet" href="styles.css" />
  <script src="script.js"></script>
</head>

<body style="
  margin: 0;
  padding: 0;
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  color: #333;
  background: url('https://images.pexels.com/photos/574919/pexels-photo-574919.jpeg') center/cover no-repeat fixed;
  min-height: 100vh;
">

  <div style="
  position: fixed;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background: rgba(248, 255, 254, 0.2); /* less fade */
  z-index:-1;
"></div>


  <!-- Header -->
  <header style="
    background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
    color: white;
    padding: 2rem;
    text-align: center;
    font-family: 'Poppins', sans-serif;
    box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
  ">
    <h1 style="margin:0; font-size:2.5rem;">Your Cart</h1>
  </header>

  <!-- Cart Container -->
  <main style="max-width: 1200px; margin: 2rem auto; padding: 0 1rem;">
    <div id="cart" style="
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 1.5rem;
    "></div>

    <!-- Checkout Button -->
    <div style="text-align:center; margin-top: 3rem;">
      <button onclick="checkout()" style="
        background: #22c55e;
        color: white;
        border: none;
        padding: 1rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        font-size: 1rem;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
      " onmouseover="
        this.style.background='#16a34a';
        this.style.transform='translateY(-2px)';
        this.style.boxShadow='0 6px 20px rgba(34, 197, 94, 0.6)';
      " onmouseout="
        this.style.background='#22c55e';
        this.style.transform='translateY(0)';
        this.style.boxShadow='0 4px 15px rgba(34, 197, 94, 0.4)';
      ">
        Place Order
      </button>
    </div>
  </main>

  <!-- Cart Card Template -->
  <script>
    async function loadCart() {
      const token = getToken();
      const res = await fetch(`${API_URL}/cart`, {
        headers: { "Authorization": `Bearer ${token}` }
      });
      const cart = await res.json();
      const container = document.getElementById("cart");
      container.innerHTML = "";
      cart.items.forEach(it => {
        const card = document.createElement('div');
        card.style.cssText = `
          background: white;
          border-radius: 16px;
          padding: 1.5rem;
          box-shadow: 0 4px 15px rgba(0,0,0,0.08);
          display: flex;
          flex-direction: column;
          justify-content: space-between;
          transition: all 0.3s ease;
        `;
        card.onmouseenter = () => {
          card.style.transform = 'translateY(-5px)';
          card.style.boxShadow = '0 12px 30px rgba(0,0,0,0.15)';
        };
        card.onmouseleave = () => {
          card.style.transform = 'translateY(0)';
          card.style.boxShadow = '0 4px 15px rgba(0,0,0,0.08)';
        };

        card.innerHTML = `
          <h3 style="margin:0 0 0.5rem 0; font-size:1.25rem; color:#374151;">${it.product.name}</h3>
          <p style="margin:0 0 1rem 0; color:#6b7280;">Quantity: ${it.qty}</p>
          <button onclick="removeItem('${it.product._id}')" style="
            background: #ef4444;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
          " onmouseover="
            this.style.background='#dc2626';
            this.style.transform='translateY(-1px)';
          " onmouseout="
            this.style.background='#ef4444';
            this.style.transform='translateY(0)';
          ">
            Remove
          </button>
        `;
        container.appendChild(card);
      });
    }

    async function removeItem(productId) {
      const token = getToken();
      await fetch(`${API_URL}/cart/remove`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify({ productId })
      });
      loadCart();
    }

    async function checkout() {
      const token = getToken();
      const res = await fetch(`${API_URL}/orders/checkout`, {
        method: "POST",
        headers: { "Authorization": `Bearer ${token}` }
      });
      if (res.ok) {
        alert("Order placed!");
        loadCart();
      } else {
        alert("Checkout failed");
      }
    }

    loadCart();
  </script>
</body>

</html>